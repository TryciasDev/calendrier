<div class="jumbotron jumbotron-fluid text-center">
		  <h1>Calendrier de {{@ami->identifiant}} ...</h1>
		  <p>Ci dessous le calendrier de {{@ami->identifiant}} concoctée par toi et vos amis commun.</p>
		  <p>les défis, attentions, portée par des tiers absent de ton cercle ne sont te sont pas visible</p> 
</div>
<div class="modal fade" id="confirmAddDefi" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
  <p><br> </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <!--repeat group="{{ @datas }}" value="{{ @jour }}" key="{{ @ikey }}"-->
  <repeat group="{{ @datas }}" key="{{ @jour }}" value="{{ @infos }}">
    <div class="card" id="{{ @jour }}">
      <div class="card-body">
        <h5 class="card-title">{{ @infos['date'] }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">{{ @infos['nbDefiTotal'] }} défis dont {{ @infos['nbDefi'] }}  fourni par votre groupe d'ami commun</h6>
        <repeat group="{{ @infos['defis'] }}" key="{{ @id }}" value="{{ @defi }}">
          <p class="card-text">Défi #{{ @id+1 }} par {{ @defi['auteur'] }}: <span id="descDefi_{{ @jour+1}}"> {{ @defi['desc'] }}</span>
          <check if="{{ @auteur==@defi['idAuteur'] }}">
              <true>
                <a class="card-link addDefi" href="#" id="updateDefi{{@jour+1}}" data-idEvent="{{ @defi['idEvent']}}">modifier</a>
                
                <!-- il serait bien que la suppression soit en ajax -->
                <!-- tout comme l'ajout / modification des défis -->
                <a class="card-link" href="javascript:deleteDefi({{ @defi['idEvent']}})">supprimer ({{ @defi['idEvent']}})</a>                
              </true>
          </check>
          </p>
          <check if="{{ @defi['isDone'] == 'true'}}">
              <true>
              <h12> Le {{ @defi['dateRealisation'] }} :  {{ @defi['commentaireVictime'] }}  </h12>
               </true>
          </check>
        </repeat>
        <p>
	        <a class="card-link addDefi" id="addDefi{{ @jour+1 }}" data-jour="{{ @jour+1 }}" href="#">Ajouter un défi</a>
			<div class="hide" id="addDefi_{{ @jour+1 }}">
				<form id="formulaire_{{ @jour+1 }}">
					<input type="text" name="auteur" id="auteur_{{ @jour+1 }}" value="{{@auteur}}" />
					<input type="text" name="victime" id="victime_{{ @jour+1 }}" value="{{@ami->numero}}" />
					<input type="text" name="idEvent" id="idEvent_{{ @jour+1 }}" value="" />
				  <div class="form-group">
					<label for="defi">Défis</label>
					<textarea class="form-control form-control-plaintext" id="defi_{{ @jour+1 }}" name="defi" rows="3" maxlength="250"></textarea>
				  </div>
				<button class="btn btn-primary" id="Save_{{ @jour+1 }}" data-jour="{{ @jour+1 }}" data-toggle="modal" data-target="#confirmAddDefi" data-victime="{{@ami->identifiant}}" >Enregistrer</button>
				</form>
			</div>
      </p>
      </div>
    </div>
  </repeat>	
</div>
<script type="text/javascript">
$(document).ready(function(){
  $(".hide").hide();
	  // avant envoie du formulaire, on fait une alerte pour s'assurer que le défi conviendra à sa victime
		$('#confirmAddDefi').on('show.bs.modal', function (event) {
			  var button = $(event.relatedTarget) // Button that triggered the modal
			  var jour = button.data('jour') // Extract info from data-* attributes
			  var idEvent = button.data('idEvent') // Extract info from data-* attributes
			  var victime = button.data('victime') // Extract info from data-* attributes
			  // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
			  // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
			  var modal = $(this)

			  modal.find('.modal-title').text("Avant de valider, êtes vous sûr que "+victime+" va apprécier ?")
			  modal.find('.modal-body').text("Est ce que votre surprise est en accord avec le message laisser par "+victime+" : Alors voilà.		Pour le sport, il ne faut pas que le tout fasse plus de quinze minutes (hors weekend). Pour le reste, je laisse libre à votre imagination")
			});
  
  <repeat group="{{ @datas }}" key="{{ @jour }}" value="{{ @infos }}">
    $("#Save_{{ @jour+1 }}").click(function(){
      $("#formId").val("formulaire_{{ @jour+1 }}");
	  //étape 1 vérifier le formulaire
	  if($("#auteur_{{ @jour+1 }}").val() == undefined || $("#auteur_{{ @jour+1 }}").val() == '')
	  {
	  	alert('Désolé, nous avons perdu votre connexion. veuillez vous déconnecter et reconnecter');
	  	break;
	  } else  if($("#victime_{{ @jour+1 }}").val() == undefined || $("#victime_{{ @jour+1 }}").val() == '')
	  {
	  	alert('Désolé, nous avons perdu votre connexion. veuillez vous déconnecter et reconnecter');
	  	break;
	  } else if($("#defi_{{ @jour+1 }}").val() == undefined || $("#defi_{{ @jour+1 }}").val() == '')
	  {
	  	if($("#idEvent_{{@jour+1}}.val() != '') {
	  		alert('Le texte de la surprise/défi choisi est obligatoire. Si vous souhaitez supprimer votre attention, merci de cliquer sur supprimer');
	  	}
	  	else {
	  		alert('Le texte de la surprise/défi choisi est obligatoire');
	  	}
	  	break;
	  } else
	  {
	  	//étape 2 afficher la pop up de validation copain friendly
	  // peut être queça se fait tout seul mais dans ce cas, il faut lui donner les billes pour envoyer le bon form
	  }
	  
	  //étape 3 envoie requête ajax
//TODO mettre en place la popup de confirmation peut se faire hors ligne
//      $("#confirmAddDefi").show();
	  var url = "/addDefi/{{@auteur}}/{{@ami->numero}}/{{ @jour+1 }}";
      if($("#idEvent_{{ @jour+1 }}").val() != '')
      {
        url = url+"/"+$("#idEvent_{{ @jour+1 }}").val();
      }
      var data = {auteurId:$("#auteur_{{ @jour+1 }}").val(), 
                  victimeId:$("#victime_{{ @jour+1 }}").val(), 
                  defi:$("#defi_{{ @jour+1 }}").val(), 
                  idEvent:$("#idEvent_{{ @jour+1 }}").val()}
                  ;
      alert(url);
      /*
      var posting = $.post( url, data );
      posting.done(function( data ) {
        alert('success');
      });/**/
      $.post({url: url,
             // method = "POST",
              data: data,
           /*   statusCode: {
                  404: function() {
                    alert( "page not found" );
                  }
                  503: function() {
                    alert( "forbidden" );
                  }
                  200: function() {
                    alert( "fine" );
                  }
                },*/
               success: function(result){
             // $("#div1").html(result);
             alert('SUCCESS : '+result);
          }})
        .done(function(){
            alert("test : Done");
          })
        .fail(function() {
            alert( "error" );
          })
        .always(function() {
            alert( "complete" );
          })
        ;

    });
    $("#addDefi{{ @jour+1 }}").click(function(){
      $("#idEvent_{{ @jour+1 }}").val('');
      $("#defi_{{ @jour+1 }}").val('Ecrire ici');
      $("#addDefi_{{ @jour+1 }}").show();
    });
      <repeat group="{{ @infos['defis'] }}" key="{{ @id }}" value="{{ @defi }}">
        $("#updateDefi{{@jour+1}}").click(function(){
          $("#idEvent_{{ @jour+1 }}").val({{ @defi['idEvent']}});
          $("#defi_{{ @jour+1 }}").val("{{ @defi['desc'] }}");
          $("#addDefi_{{ @jour+1 }}").show();
        });
      </repeat>
  </repeat>
//prompt un message de confirmation que les conditions de la victime sont réalisés
});
</script>
<!--script type="text/javascript" src="/../App/js/defi.add.js"></script-->